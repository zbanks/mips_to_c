struct _mips2c_stack_EnKgy_Destroy {
    /* 0x00 */ char pad0[0x18];
};                                                  /* size = 0x18 */

struct _mips2c_stack_EnKgy_Draw {
    /* 0x00 */ char pad0[0x30];
};                                                  /* size = 0x30 */

struct _mips2c_stack_EnKgy_Init {
    /* 0x00 */ char pad0[0x48];
};                                                  /* size = 0x48 */

struct _mips2c_stack_EnKgy_Update {
    /* 0x00 */ char pad0[0x30];
    /* 0x30 */ s16 sp30;                            /* inferred */
    /* 0x32 */ s16 sp32;                            /* inferred */
    /* 0x34 */ s16 sp34;                            /* inferred */
    /* 0x36 */ char pad36[0xA];
};                                                  /* size = 0x40 */

struct _mips2c_stack_func_80B40B38 {
    /* 0x00 */ char pad0[0x28];
    /* 0x28 */ AnimationHeaderCommon **sp28;        /* inferred */
    /* 0x2C */ char pad2C[0x4];
};                                                  /* size = 0x30 */

struct _mips2c_stack_func_80B40BC0 {
    /* 0x00 */ char pad0[0x18];
};                                                  /* size = 0x18 */

struct _mips2c_stack_func_80B40BFC {};              /* size 0x0 */

struct _mips2c_stack_func_80B40C38 {};              /* size 0x0 */

struct _mips2c_stack_func_80B40C74 {};              /* size 0x0 */

struct _mips2c_stack_func_80B40D00 {};              /* size 0x0 */

struct _mips2c_stack_func_80B40D30 {};              /* size 0x0 */

struct _mips2c_stack_func_80B40D64 {};              /* size 0x0 */

struct _mips2c_stack_func_80B40D8C {};              /* size 0x0 */

struct _mips2c_stack_func_80B40DB4 {};              /* size 0x0 */

struct _mips2c_stack_func_80B40E18 {};              /* size 0x0 */

struct _mips2c_stack_func_80B40E38 {};              /* size 0x0 */

struct _mips2c_stack_func_80B40E54 {};              /* size 0x0 */

struct _mips2c_stack_func_80B40E74 {
    /* 0x00 */ char pad0[0x18];
};                                                  /* size = 0x18 */

struct _mips2c_stack_func_80B40EBC {
    /* 0x00 */ char pad0[0x18];
};                                                  /* size = 0x18 */

struct _mips2c_stack_func_80B40EE8 {
    /* 0x00 */ char pad0[0x34];
    /* 0x34 */ f32 sp34;                            /* inferred */
    /* 0x38 */ f32 sp38;                            /* inferred */
    /* 0x3C */ char pad3C[0xC];
};                                                  /* size = 0x48 */

struct _mips2c_stack_func_80B411DC {};              /* size 0x0 */

struct _mips2c_stack_func_80B41368 {
    /* 0x00 */ char pad0[0x18];
};                                                  /* size = 0x18 */

struct _mips2c_stack_func_80B413C8 {
    /* 0x00 */ char pad0[0x1C];
    /* 0x1C */ ? sp1C;                              /* inferred */
    /* 0x1C */ char pad1C[0xC];
};                                                  /* size = 0x28 */

struct _mips2c_stack_func_80B41460 {};              /* size 0x0 */

struct _mips2c_stack_func_80B41528 {};              /* size 0x0 */

struct _mips2c_stack_func_80B415A8 {
    /* 0x00 */ char pad0[0x24];
    /* 0x24 */ s32 sp24;                            /* inferred */
};                                                  /* size = 0x28 */

struct _mips2c_stack_func_80B4163C {
    /* 0x00 */ char pad0[0x24];
    /* 0x24 */ SkelAnime *sp24;                     /* inferred */
};                                                  /* size = 0x28 */

struct _mips2c_stack_func_80B417B8 {
    /* 0x00 */ char pad0[0x20];
};                                                  /* size = 0x20 */

struct _mips2c_stack_func_80B41858 {
    /* 0x00 */ char pad0[0x20];
};                                                  /* size = 0x20 */

struct _mips2c_stack_func_80B418C4 {
    /* 0x00 */ char pad0[0x20];
};                                                  /* size = 0x20 */

struct _mips2c_stack_func_80B419B0 {
    /* 0x00 */ char pad0[0x20];
    /* 0x20 */ Actor *sp20;                         /* inferred */
    /* 0x24 */ char pad24[0x4];
};                                                  /* size = 0x28 */

struct _mips2c_stack_func_80B41A48 {
    /* 0x00 */ char pad0[0x18];
};                                                  /* size = 0x18 */

struct _mips2c_stack_func_80B41ACC {
    /* 0x00 */ char pad0[0x20];
    /* 0x20 */ void *sp20;                          /* inferred */
    /* 0x24 */ s32 sp24;                            /* inferred */
};                                                  /* size = 0x28 */

struct _mips2c_stack_func_80B41C30 {};              /* size 0x0 */

struct _mips2c_stack_func_80B41C54 {
    /* 0x00 */ char pad0[0x18];
};                                                  /* size = 0x18 */

struct _mips2c_stack_func_80B41CBC {
    /* 0x00 */ char pad0[0x28];
};                                                  /* size = 0x28 */

struct _mips2c_stack_func_80B41D64 {
    /* 0x00 */ char pad0[0x28];
};                                                  /* size = 0x28 */

struct _mips2c_stack_func_80B41E18 {
    /* 0x00 */ char pad0[0x2C];
    /* 0x2C */ s32 sp2C;                            /* inferred */
    /* 0x30 */ void *sp30;                          /* inferred */
    /* 0x34 */ char pad34[0x8];                     /* maybe part of sp30[3]? */
    /* 0x3C */ Actor *sp3C;                         /* inferred */
    /* 0x40 */ char pad40[0x6];                     /* maybe part of sp3C[2]? */
    /* 0x46 */ u16 sp46;                            /* inferred */
};                                                  /* size = 0x48 */

struct _mips2c_stack_func_80B42508 {
    /* 0x00 */ char pad0[0x20];
    /* 0x20 */ Actor *sp20;                         /* inferred */
    /* 0x24 */ char pad24[0x4];
};                                                  /* size = 0x28 */

struct _mips2c_stack_func_80B425A0 {
    /* 0x00 */ char pad0[0x20];
};                                                  /* size = 0x20 */

struct _mips2c_stack_func_80B42660 {
    /* 0x00 */ char pad0[0x20];
};                                                  /* size = 0x20 */

struct _mips2c_stack_func_80B42714 {
    /* 0x00 */ char pad0[0x20];
    /* 0x20 */ Actor *sp20;                         /* inferred */
    /* 0x24 */ char pad24[0x4];
};                                                  /* size = 0x28 */

struct _mips2c_stack_func_80B427C8 {
    /* 0x00 */ char pad0[0x24];
    /* 0x24 */ s32 sp24;                            /* inferred */
    /* 0x28 */ char pad28[0x8];
};                                                  /* size = 0x30 */

struct _mips2c_stack_func_80B4296C {
    /* 0x00 */ char pad0[0x28];
};                                                  /* size = 0x28 */

struct _mips2c_stack_func_80B42A8C {
    /* 0x00 */ char pad0[0x24];
    /* 0x24 */ s32 sp24;                            /* inferred */
    /* 0x28 */ char pad28[0x6];                     /* maybe part of sp24[2]? */
    /* 0x2E */ u16 sp2E;                            /* inferred */
};                                                  /* size = 0x30 */

struct _mips2c_stack_func_80B42D28 {
    /* 0x00 */ char pad0[0x20];
};                                                  /* size = 0x20 */

struct _mips2c_stack_func_80B42FA0 {};              /* size 0x0 */

struct _mips2c_stack_func_80B43008 {
    /* 0x00 */ char pad0[0x18];
};                                                  /* size = 0x18 */

struct _mips2c_stack_func_80B43074 {
    /* 0x00 */ char pad0[0x1C];
    /* 0x1C */ GraphicsContext *sp1C;               /* inferred */
    /* 0x20 */ Gfx *sp20;                           /* inferred */
    /* 0x24 */ char pad24[0x4];
};                                                  /* size = 0x28 */

void func_80B40B38(EnKgy *arg0, s16 arg1, u8 arg2, f32 arg3); /* static */
void func_80B40BC0(EnKgy *arg0, s16 arg1, u16);     /* static */
EnKbt *func_80B40BFC(GlobalContext *arg0);          /* static */
ObjIcePoly *func_80B40C38(GlobalContext *arg0);     /* static */
void func_80B40C74(GlobalContext *arg0);            /* static */
void func_80B40D00(GlobalContext *arg0, s32);       /* static */
s32 func_80B40D8C(GlobalContext *arg0);             /* static */
void func_80B40E18(EnKgy *arg0, u16 arg1);          /* static */
void func_80B40E38(EnKgy *arg0);                    /* static */
s16 func_80B40E54(EnKgy *arg0);                     /* static */
void func_80B40E74(EnKgy *arg0, GlobalContext *arg1, u16 arg2); /* static */
void func_80B40EBC(s32 arg2, GlobalContext *, u16); /* static */
void func_80B40EE8(EnKgy *arg0, GlobalContext *arg1, Actor *); /* static */
void func_80B411DC(EnKgy *arg0, GlobalContext *arg1, u32 arg2); /* static */
void func_80B41368(EnKgy *arg0, GlobalContext *arg1, u32 arg2); /* static */
void func_80B413C8(EnKgy *arg0);                    /* static */
u16 func_80B41460();                                /* static */
s32 func_80B41528(GlobalContext *arg0);             /* static */
void func_80B415A8(GlobalContext *arg0, Vec3f *arg1); /* static */
void func_80B4163C(EnKgy *arg0, GlobalContext *arg1); /* static */
void func_80B417B8(EnKgy *arg0, GlobalContext *arg1); /* static */
void func_80B41858(EnKgy *arg0, GlobalContext *arg1); /* static */
void func_80B418C4(EnKgy *arg0, GlobalContext *arg1); /* static */
void func_80B41ACC(EnKgy *arg0, GlobalContext *arg1); /* static */
void func_80B41C30(void *arg0, void *arg1);         /* static */
void func_80B41C54(Actor *arg0, GlobalContext *arg1); /* static */
void func_80B41CBC(Actor *arg0, GlobalContext *arg1); /* static */
void func_80B41D64(Actor *arg0, GlobalContext *arg1); /* static */
void func_80B42660(EnKgy *arg0, GlobalContext *arg1); /* static */
void func_80B427C8(EnKgy *arg0, GlobalContext *arg1); /* static */
void func_80B4296C(EnKgy *arg0, GlobalContext *arg1); /* static */
void func_80B42A8C(EnKgy *arg0, GlobalContext *arg1); /* static */
s32 func_80B42FA0(GlobalContext *arg0, s32 arg1, Gfx **arg2, Vec3f *arg3, s16 *arg4, Actor *arg5); /* static */
void func_80B43008(GlobalContext *arg0, s32 arg1, Gfx **arg2, Vec3s *arg3, Actor *arg4); /* static */
void func_80B43074(Actor *arg0, GlobalContext *arg1); /* static */
extern ? D_04001D00;
extern ? D_040021A8;
extern AnimationHeader D_06004B98;
extern ? D_0600E8F0;
extern void D_0600EE58;
extern ? D_0600F180;
extern void D_0600F6A0;
extern FlexSkeletonHeader D_0600F910;
static ? D_80B43270;                                /* unable to generate initializer */
static void D_80B43298;                             /* unable to generate initializer */
static s16 D_80B432CA[7] = {0, 0x80, 0xFF00, 0x12C, 0, 0, 0};
static Vec3f D_80B432D8 = {1000.0f, 2000.0f, 0.0f};
static Vec3f D_80B432E4 = {3000.0f, 4000.0f, 300.0f};

void EnKgy_Init(EnKgy *this, GlobalContext *globalCtx) {
    LightInfo *temp_s0;
    s32 temp_s1;
    s16 phi_s0;
    EnKgy *phi_s2;
    s32 phi_s1;
    EnKgy *this = (EnKgy *) thisx;

    Actor_SetScale((Actor *) this, 0.01f);
    SkelAnime_InitSV(globalCtx, &this->skelAnime, &D_0600F910, &D_06004B98, this->jointTable, this->morphTable, 0x17);
    this->unk_2D2 = -1;
    this->unk_29C = 0;
    this->unk_2E4 = 0;
    this->unk_2E2 = -1;
    this->zubora = func_80B40BFC(globalCtx);
    this->iceBlock = func_80B40C38(globalCtx);
    Actor_UnsetSwitchFlag(globalCtx, ((s32) (this->actor.params & 0xFE00) >> 9) + 1);
    if ((Flags_GetSwitch(globalCtx, (s32) (this->actor.params & 0xFE00) >> 9) != 0) || ((gSaveContext.weekEventReg[33] & 0x80) != 0)) {
        Actor_SetSwitchFlag(globalCtx, ((s32) (this->actor.params & 0xFE00) >> 9) + 1);
        globalCtx->envCtx.unk_C3 = 1;
        gSaveContext.weekEventReg[21] |= 1;
        if (func_80B40D64(globalCtx) == 0) {
            func_80B40B38(this, 4, 0U, 0.0f);
            this->actionFunc = func_80B425A0;
            this->actor.textId = 0xC35;
        } else if (func_80B40DB4(globalCtx) == 0) {
            func_80B40B38(this, 6, 2U, 0.0f);
            this->actionFunc = func_80B419B0;
            this->actor.textId = 0xC4E;
            this->unk_29C |= 1;
            this->unk_2EA = 3;
        } else {
            func_80B40B38(this, 4, 0U, 0.0f);
            this->actionFunc = func_80B42714;
            this->actor.textId = 0xC50;
        }
    } else {
        if ((gSaveContext.weekEventReg[20] & 0x80) != 0) {
            func_80B40B38(this, 4, 0U, 0.0f);
        } else {
            func_80B40B38(this, 0, 0U, 0.0f);
        }
        this->actionFunc = func_80B42D28;
    }
    phi_s0 = (s16) this->actor.cutscene;
    phi_s2 = this;
    phi_s1 = 0;
    do {
        phi_s2->unk_2D4[0] = phi_s0;
        if (phi_s0 != -1) {
            this->actor.cutscene = (s8) phi_s0;
            phi_s0 = ActorCutscene_GetAdditionalCutscene((s16) this->actor.cutscene);
        }
        temp_s1 = phi_s1 + 2;
        phi_s2 += 2;
        phi_s1 = temp_s1;
    } while (temp_s1 != 0xC);
    temp_s0 = &this->lightInfo;
    Lights_PointNoGlowSetInfo(temp_s0, (s16) (s32) this->actor.world.pos.x, (s16) (s32) this->actor.world.pos.y, (s16) (s32) this->actor.world.pos.z, (u8) 0xFF, (u8) 0x40, (u8) 0x40, (s16) (s32) -1);
    this->lightNode = LightContext_InsertLight(globalCtx, &globalCtx->lightCtx, temp_s0);
    this->unk_300 = -1;
    this->actor.flags &= -2;
}

void EnKgy_Destroy(EnKgy *this, GlobalContext *globalCtx) {
    EnKgy *this = (EnKgy *) thisx;
    LightContext_RemoveLight(globalCtx, &globalCtx->lightCtx, this->lightNode);
}

void func_80B40B38(EnKgy *arg0, s16 arg1, u8 arg2, f32 arg3) {
    AnimationHeaderCommon **sp28;
    AnimationHeaderCommon **temp_v1;

    temp_v1 = (arg1 * 4) + &D_80B43270;
    sp28 = temp_v1;
    SkelAnime_ChangeAnim(arg0 + 0x144, (AnimationHeader *) *temp_v1, 1.0f, 0.0f, (f32) SkelAnime_GetFrameCount(*temp_v1), (u8) (s32) arg2, arg3);
    arg0->unk_2D2 = arg1;
}

void func_80B40BC0(EnKgy *arg0, s16 arg1) {
    if (arg1 != arg0->unk_2D2) {
        func_80B40B38((EnKgy *) arg1, 0, 0xC0A00000U);
    }
}

EnKbt *func_80B40BFC(GlobalContext *arg0) {
    EnKbt *temp_v1;
    EnKbt *temp_v1_2;
    EnKbt *phi_v1;

    temp_v1 = arg0->actorCtx.actorList[4].first;
    phi_v1 = temp_v1;
    if (temp_v1 != 0) {
loop_1:
        if (phi_v1->actor.id == 0x1F6) {
            return phi_v1;
        }
        temp_v1_2 = phi_v1->actor.next;
        phi_v1 = temp_v1_2;
        if (temp_v1_2 == 0) {
            /* Duplicate return node #4. Try simplifying control flow for better match */
            return NULL;
        }
        goto loop_1;
    }
    return NULL;
}

ObjIcePoly *func_80B40C38(GlobalContext *arg0) {
    ObjIcePoly *temp_v1;
    ObjIcePoly *temp_v1_2;
    ObjIcePoly *phi_v1;

    temp_v1 = arg0->actorCtx.actorList[7].first;
    phi_v1 = temp_v1;
    if (temp_v1 != 0) {
loop_1:
        if (phi_v1->actor.id == 0x8E) {
            return phi_v1;
        }
        temp_v1_2 = phi_v1->actor.next;
        phi_v1 = temp_v1_2;
        if (temp_v1_2 == 0) {
            /* Duplicate return node #4. Try simplifying control flow for better match */
            return NULL;
        }
        goto loop_1;
    }
    return NULL;
}

void func_80B40C74(GlobalContext *arg0) {
    void *temp_v0;
    void *temp_v0_2;
    void *temp_v0_3;

    temp_v0 = &gSaveContext + (arg0->sceneNum * 0x1C);
    temp_v0->unk10C = (s32) (temp_v0->unk10C | 1);
    if (((s32) gSaveContext.day % 5) == 1) {
        temp_v0_2 = &gSaveContext + (arg0->sceneNum * 0x1C);
        temp_v0_2->unk10C = (s32) (temp_v0_2->unk10C | 2);
        return;
    }
    temp_v0_3 = &gSaveContext + (arg0->sceneNum * 0x1C);
    temp_v0_3->unk10C = (s32) (temp_v0_3->unk10C & ~2);
}

void func_80B40D00(GlobalContext *arg0) {
    void *temp_v0;

    temp_v0 = (arg0->sceneNum * 0x1C) + &gSaveContext;
    temp_v0->unk10C = (s32) (temp_v0->unk10C | 4);
}

void func_80B40D30(GlobalContext *globalCtx) {
    void *temp_v0;

    temp_v0 = (globalCtx->sceneNum * 0x1C) + &gSaveContext;
    temp_v0->unk10C = (s32) (temp_v0->unk10C & ~7);
}

s32 func_80B40D64(GlobalContext *globalCtx) {
    return *(&gSaveContext.roomInf[0][5] + (globalCtx->sceneNum * 0x1C)) & 1;
}

s32 func_80B40D8C(GlobalContext *arg0) {
    return *(&gSaveContext.roomInf[0][5] + (arg0->sceneNum * 0x1C)) & 4;
}

s32 func_80B40DB4(GlobalContext *globalCtx) {
    s32 temp_hi;

    temp_hi = (s32) gSaveContext.day % 5;
    if ((temp_hi == 3) || ((temp_hi == 2) && (((&gSaveContext + (globalCtx->sceneNum * 0x1C))->unk10C & 2) != 0))) {
        return 1;
    }
    return 0;
}

void func_80B40E18(EnKgy *arg0, u16 arg1) {
    void *temp_v0;

    temp_v0 = arg0->zubora;
    if (temp_v0 != 0) {
        temp_v0->actor.textId = arg1 & 0xFFFF;
    }
}

void func_80B40E38(EnKgy *arg0) {
    void *temp_v0;

    temp_v0 = arg0->zubora;
    if (temp_v0 != 0) {
        temp_v0->actor.home.rot.z = 1;
    }
}

s16 func_80B40E54(EnKgy *arg0) {
    void *temp_v1;

    temp_v1 = arg0->zubora;
    if (temp_v1 != 0) {
        return temp_v1->unk18;
    }
    return 0;
}

void func_80B40E74(EnKgy *arg0, GlobalContext *arg1, u16 arg2) {
    arg0 = arg0;
    func_80151938(arg1, arg2);
    arg0->actor.textId = arg2;
    func_80B40E18(arg0, arg2 & 0xFFFF);
}

void func_80B40EBC(s32 arg2) {
    func_80B40E74((EnKgy *) (((arg2 & 0xFFFF) + 1) & 0xFFFF));
}

void func_80B40EE8(EnKgy *arg0, GlobalContext *arg1) {
    f32 sp38;
    f32 sp34;
    f32 temp_f0;
    s16 temp_a1;
    s16 temp_v0;
    s16 temp_v0_2;
    s16 temp_v0_4;
    u16 temp_a2;
    u16 temp_v0_3;

    temp_v0 = arg0->unk_2E4;
    if ((s32) temp_v0 > 0) {
        arg0->unk_2E4 = temp_v0 - 1;
        if (arg0->unk_2E4 == 0) {
            temp_a1 = arg0->unk_2E2;
            if ((s32) temp_a1 >= 0) {
                if (temp_a1 == 3) {
                    func_80B40B38(arg0, 3, 2U, -5.0f);
                } else {
                    func_80B40BC0(arg0, temp_a1);
                }
                arg0->unk_2E2 = -1;
            }
        }
    }
    if ((arg0->unk_2E0 != -1) && (ActorCutscene_GetCurrentIndex() != arg0->unk_2D4[arg0->unk_2E0])) {
        if (ActorCutscene_GetCurrentIndex() == 0x7C) {
            ActorCutscene_Stop(0x7C);
            ActorCutscene_SetIntentToPlay(arg0->unk_2D4[arg0->unk_2E0]);
        } else if (ActorCutscene_GetCanPlayNext(arg0->unk_2D4[arg0->unk_2E0]) != 0) {
            ActorCutscene_StartAndSetUnkLinkFields(arg0->unk_2D4[arg0->unk_2E0], (Actor *) arg0);
        } else {
            ActorCutscene_SetIntentToPlay(arg0->unk_2D4[arg0->unk_2E0]);
        }
    }
    if ((arg0->unk_29C & 2) != 0) {
        func_800B4EDC(arg1, &arg0->unk_2B4, (Vec3f *) &sp38, &sp34);
        temp_v0_2 = arg0->unk_2E6;
        temp_f0 = sp38 * sp34;
        if ((s32) temp_v0_2 > 0) {
            arg0->unk_2E6 = temp_v0_2 - 1;
        }
        if (((temp_f0 < 0.15f) && (temp_f0 > -0.15f)) || (arg0->unk_2E6 == 0)) {
            func_80151938(arg1, arg0->actor.textId);
            arg0->unk_29C &= 0xFFFD;
            func_80B40E18(arg0, arg0->actor.textId);
            temp_v0_3 = arg0->actor.textId;
            if (temp_v0_3 != 0xC22) {
                if (temp_v0_3 != 0xC43) {
                    if ((temp_v0_3 != 0xC52) && (temp_v0_3 != 0xC54)) {

                    } else {
                        func_80B40BC0(arg0, 1);
                    }
                } else {
                    if (func_80B40D64(arg1) != 0) {
                        func_80B40BC0(arg0, 7);
                    } else {
                        func_80B40BC0(arg0, 1);
                    }
                    arg0->unk_2E4 = 0x1E;
                    arg0->actionFunc = func_80B41A48;
                }
            } else {
                arg0->unk_2E4 = 0x14;
                arg0->unk_2E2 = 3;
            }
        }
    }
    if ((arg0->unk_29C & 4) != 0) {
        temp_v0_4 = arg0->unk_2E8;
        if ((s32) temp_v0_4 > 0) {
            arg0->unk_2E8 = temp_v0_4 - 1;
        } else {
            arg0->unk_2E8 = 0;
        }
        if (arg0->unk_2E8 == 0) {
            temp_a2 = arg0->actor.textId;
            if ((temp_a2 == 0xC1D) || (temp_a2 == 0xC2D)) {
                arg0->unk_2E4 = 0x14;
                arg0->unk_2E2 = 3;
                func_80B40EBC((s32) arg0, arg1, temp_a2);
            } else {
                func_80B40EBC((s32) arg0, arg1, temp_a2);
            }
            arg0->unk_29C &= 0xFFFB;
        }
    }
}

void func_80B411DC(EnKgy *arg0, GlobalContext *arg1, u32 arg2) {
    void *temp_t0;
    void *temp_t3;
    void *temp_t9;
    void *temp_v0;
    void *temp_v0_2;
    void *temp_v0_3;
    void *temp_v1;
    void *temp_v1_2;
    void *temp_v1_3;

    temp_v0 = arg1->actorCtx.actorList[2].first;
    switch (arg2) {
    case 0:
        temp_v0_2 = arg0 + 0x2A8;
        arg0->unk_2B4.x = temp_v0_2->unk0;
        arg0->unk_2B4.y = temp_v0_2->unk4;
        arg0->unk_2B4.z = temp_v0_2->unk8;
        arg0->actor.focus.pos.x = temp_v0_2->unk0;
        arg0->actor.focus.pos.y = temp_v0_2->unk4;
        arg0->unk_2E0 = 0;
        arg0->actor.focus.pos.z = temp_v0_2->unk8;
        return;
    case 1:
        temp_v1 = arg0->zubora;
        if (temp_v1 != 0) {
            temp_t3 = arg0->zubora;
            arg0->unk_2B4.x = temp_v1->actor.focus.pos.x;
            arg0->unk_2B4.y = temp_v1->actor.focus.pos.y;
            arg0->unk_2B4.z = temp_v1->actor.focus.pos.z;
            arg0->actor.focus.pos.x = temp_t3->actor.focus.pos.x;
            arg0->actor.focus.pos.y = temp_t3->actor.focus.pos.y;
            arg0->actor.focus.pos.z = temp_t3->actor.focus.pos.z;
        }
        arg0->unk_2E0 = 1;
        return;
    case 2:
        temp_v0_3 = arg0->iceBlock;
        if (temp_v0_3 != 0) {
            temp_t9 = arg0->iceBlock;
            arg0->unk_2B4.x = temp_v0_3->actor.world.pos.x;
            arg0->unk_2B4.y = temp_v0_3->actor.world.pos.y;
            arg0->unk_2B4.z = temp_v0_3->actor.world.pos.z;
            arg0->actor.focus.pos.x = temp_t9->actor.focus.pos.x;
            arg0->actor.focus.pos.y = temp_t9->actor.focus.pos.y;
            arg0->actor.focus.pos.z = temp_t9->actor.focus.pos.z;
        }
        arg0->unk_2E0 = 2;
        return;
    case 3:
        temp_v1_2 = arg0->zubora;
        arg0->unk_2B4.x = temp_v0->world.pos.x;
        arg0->unk_2B4.y = temp_v0->world.pos.y;
        arg0->unk_2B4.z = temp_v0->world.pos.z;
        if (temp_v1_2 != 0) {
            arg0->actor.focus.pos.x = temp_v1_2->actor.focus.pos.x;
            arg0->actor.focus.pos.y = temp_v1_2->actor.focus.pos.y;
            arg0->actor.focus.pos.z = temp_v1_2->actor.focus.pos.z;
        }
        arg0->unk_2E0 = 3;
        return;
    case 4:
        temp_v1_3 = arg0->zubora;
        if (temp_v1_3 != 0) {
            temp_t0 = arg0->zubora;
            arg0->unk_2B4.x = temp_v1_3->actor.focus.pos.x;
            arg0->unk_2B4.y = temp_v1_3->actor.focus.pos.y;
            arg0->unk_2B4.z = temp_v1_3->actor.focus.pos.z;
            arg0->actor.focus.pos.x = temp_t0->actor.focus.pos.x;
            arg0->actor.focus.pos.y = temp_t0->actor.focus.pos.y;
            arg0->actor.focus.pos.z = temp_t0->actor.focus.pos.z;
        }
        arg0->unk_2E0 = 4;
        /* fallthrough */
    default:
        return;
    }
}

void func_80B41368(EnKgy *arg0, GlobalContext *arg1, u32 arg2) {
    s16 temp_a0;

    temp_a0 = (arg0 + (arg0->unk_2E0 * 2))->unk2D4;
    arg0 = arg0;
    ActorCutscene_Stop(temp_a0);
    func_80B411DC(arg0, arg1, arg2);
    arg0->unk_2E6 = 0x14;
    arg0->unk_29C |= 2;
}

void func_80B413C8(EnKgy *arg0) {
    ? sp1C;
    s16 temp_a0;

    sp1C.unk0 = (s32) arg0->unk_2A8.x;
    sp1C.unk4 = (s32) arg0->unk_2A8.y;
    sp1C.unk8 = (s32) arg0->unk_2A8.z;
    arg0->unk_2B4.x = sp1C.unk0;
    arg0->unk_2B4.y = sp1C.unk4;
    arg0->unk_2B4.z = sp1C.unk8;
    arg0->actor.focus.pos.x = sp1C.unk0;
    arg0->actor.focus.pos.y = sp1C.unk4;
    arg0->actor.focus.pos.z = sp1C.unk8;
    temp_a0 = (arg0 + (arg0->unk_2E0 * 2))->unk2D4;
    arg0 = arg0;
    ActorCutscene_Stop(temp_a0);
    arg0->unk_2E0 = -1;
    arg0->unk_2E6 = 0;
    arg0->unk_29C &= 0xFFFD;
}

u16 func_80B41460(void) {
    u8 temp_v0;
    u8 phi_v1;
    u8 phi_v1_2;
    u8 phi_v1_3;

    temp_v0 = gSaveContext.playerForm;
    if (temp_v0 == 4) {
        phi_v1 = temp_v0;
        if (temp_v0 == 4) {
            phi_v1 = 0U;
        }
        if ((&gSaveContext + (phi_v1 * 4))->unk4C != 0x4D) {
            phi_v1_2 = temp_v0;
            if (temp_v0 == 4) {
                phi_v1_2 = 0U;
            }
            if ((&gSaveContext + (phi_v1_2 * 4))->unk4C != 0x4E) {
                phi_v1_3 = temp_v0;
                if (temp_v0 == 4) {
                    phi_v1_3 = 0U;
                }
                if ((&gSaveContext + (phi_v1_3 * 4))->unk4C != 0x4F) {
                    /* Duplicate return node #10. Try simplifying control flow for better match */
                    return 0xC38U;
                }
                goto block_11;
            }
            goto block_11;
        }
block_11:
        if (((s32) gSaveContext.day % 5) == 3) {
            return 0xC39U;
        }
        return 0xC3AU;
    }
    return 0xC38U;
}

s32 func_80B41528(GlobalContext *arg0) {
    u8 temp_v0;
    u8 phi_v1;
    u8 phi_v1_2;

    temp_v0 = gSaveContext.playerForm;
    phi_v1 = temp_v0;
    if (temp_v0 == 4) {
        phi_v1 = 0U;
    }
    if ((&gSaveContext + (phi_v1 * 4))->unk4C == 0x4F) {
        return 0xC4C;
    }
    phi_v1_2 = temp_v0;
    if (temp_v0 == 4) {
        phi_v1_2 = 0U;
    }
    if ((&gSaveContext + (phi_v1_2 * 4))->unk4C == 0x4E) {
        return 0xC45;
    }
    return 0xC3B;
}

void func_80B415A8(GlobalContext *arg0, Vec3f *arg1) {
    s32 sp24;
    s16 *temp_at;
    s32 temp_f10;
    s32 temp_f18;
    s32 temp_f6;

    temp_at = &D_80B43298 + 6;
    temp_f6 = (s32) arg1->x;
    *temp_at = (s16) temp_f6;
    temp_f10 = (s32) arg1->y;
    *temp_at = (s16) temp_f10;
    temp_f18 = (s32) arg1->z;
    *temp_at = (s16) temp_f18;
    *D_80B432CA = (s16) temp_f6;
    *D_80B432CA = (s16) temp_f10;
    *D_80B432CA = (s16) temp_f18;
    Effect_Add(arg0, &sp24, 3, 0U, (u8) 1, &D_80B43298);
}

void func_80B4163C(EnKgy *arg0, GlobalContext *arg1) {
    SkelAnime *sp24;
    SkelAnime *temp_a0;
    s16 temp_v0;
    s32 temp_f8;

    temp_a0 = arg0 + 0x144;
    arg0->actor.focus.pos.x = arg0->unk_2A8.x;
    arg0->actor.focus.pos.y = arg0->unk_2A8.y;
    arg0->actor.focus.pos.z = arg0->unk_2A8.z;
    sp24 = temp_a0;
    if (SkelAnime_FrameUpdateMatrix(temp_a0) != 0) {
        if (arg0->unk_2D2 == 6) {
            if ((s32) arg0->unk_2EA > 0) {
                func_80B40B38(arg0, 6, 2U, 0.0f);
                arg0->unk_2EA += -1;
            } else {
                func_80B40B38(arg0, 9, 2U, -5.0f);
                arg0->unk_2EA = (s32) Rand_ZeroFloat(3.0f) + 2;
            }
        } else {
            func_80B40B38(arg0, 6, 2U, -5.0f);
        }
        SkelAnime_FrameUpdateMatrix(sp24);
    }
    temp_f8 = (s32) arg0->skelAnime.animCurrentFrame;
    switch (temp_f8) {
    case 1:
    case 7:
    case 13:
    case 19:
    case 25:
        func_80B415A8(arg1, &arg0->unk_2C0);
        arg0->unk_300 = 0xC8;
        arg0->lightInfo.params.point.x = (s16) (s32) arg0->unk_2C0.x;
        arg0->lightInfo.params.point.y = (s16) (s32) arg0->unk_2C0.y;
        arg0->lightInfo.params.point.z = (s16) (s32) arg0->unk_2C0.z;
        Audio_PlayActorSound2((Actor *) arg0, 0x29C2U);
        break;
    }
    temp_v0 = arg0->unk_300;
    arg0->lightInfo.params.point.radius = temp_v0;
    if ((s32) temp_v0 > 0) {
        arg0->unk_300 = temp_v0 - 0x32;
    }
}

void func_80B417B8(EnKgy *arg0, GlobalContext *arg1) {
    func_80B4163C(arg0, arg1);
    if ((func_80152498(&arg1->msgCtx) == 5) && (func_80147624(arg1) != 0)) {
        func_801477B4(arg1);
        func_80B413C8(arg0);
        arg0->actor.flags &= -0x101;
        arg0->actionFunc = func_80B419B0;
        func_80B40E18(arg0, 7U);
    }
    func_80B40EE8(arg0, arg1);
}

void func_80B41858(EnKgy *arg0) {
    func_80B4163C(arg0);
    if (ActorCutscene_GetCanPlayNext(arg0->unk_2D4[5]) != 0) {
        ActorCutscene_StartAndSetUnkLinkFields(arg0->unk_2D4[5], (Actor *) arg0);
        arg0->actionFunc = func_80B419B0;
        func_80B40E18(arg0, 7U);
        return;
    }
    ActorCutscene_SetIntentToPlay(arg0->unk_2D4[5]);
}

void func_80B418C4(EnKgy *arg0, GlobalContext *arg1) {
    u16 temp_v0;

    func_80B4163C(arg0, arg1);
    if (((s32) arg0->unk_2E4 <= 0) && ((arg0->unk_29C & 2) == 0) && (func_80B40E54(arg0) == 0) && (func_80152498(&arg1->msgCtx) == 5) && (func_80147624(arg1) != 0) && ((temp_v0 = arg1->msgCtx.unk11F04, (temp_v0 == 0xC4E)) || (temp_v0 == 0xC4F))) {
        func_801477B4(arg1);
        arg0->actor.textId = 0xC4F;
        func_80B413C8(arg0);
        ActorCutscene_SetIntentToPlay(arg0->unk_2D4[5]);
        arg0->actionFunc = func_80B41858;
        arg0->actor.flags &= -0x101;
    }
    func_80B40EE8(arg0, arg1);
}

void func_80B419B0(EnKgy *arg0, GlobalContext *globalCtx) {
    Actor *sp20;

    sp20 = globalCtx->actorCtx.actorList[2].first;
    func_80B4163C(arg0);
    if ((func_800B84D0((Actor *) arg0, globalCtx) != 0) || (arg0 == sp20->unkA88)) {
        func_80B411DC(arg0, globalCtx, 4U);
        func_80B40E18(arg0, arg0->actor.textId);
        if (arg0->actor.textId == 0xC37) {
            arg0->actionFunc = func_80B417B8;
            return;
        }
        arg0->actionFunc = func_80B418C4;
        /* Duplicate return node #5. Try simplifying control flow for better match */
    }
}

void func_80B41A48(EnKgy *arg0, GlobalContext *arg1) {
    SkelAnime *temp_a0;
    s16 temp_v0;

    temp_a0 = &arg0->skelAnime;
    arg0 = arg0;
    SkelAnime_FrameUpdateMatrix(temp_a0);
    temp_v0 = arg0->unk_2E4;
    if ((s32) temp_v0 > 0) {
        arg0->unk_2E4 = temp_v0 - 1;
        return;
    }
    arg1->nextEntranceIndex = arg1->setupExitList[arg0->actor.params & 0x1F];
    arg1->sceneLoadFlag = 0x14;
}

void func_80B41ACC(EnKgy *arg0, GlobalContext *arg1) {
    s32 sp24;
    void *sp20;
    s32 temp_v0;
    void *temp_v1;
    s16 phi_v0;
    s16 phi_v0_2;

    temp_v1 = arg1->actorCtx.actorList[2].first;
    sp20 = temp_v1;
    SkelAnime_FrameUpdateMatrix(arg0 + 0x144);
    if (func_80152498(arg1 + 0x4908) == 0x10) {
        sp20 = temp_v1;
        temp_v0 = func_80123810(arg1);
        if (temp_v0 != 0) {
            arg0->actionFunc = func_80B41E18;
        }
        if (temp_v0 > 0) {
            sp20 = temp_v1;
            sp24 = temp_v0;
            func_801477B4(arg1);
            if (temp_v0 == 0x1B) {
                if ((arg0->unk_29C & 0x10) != 0) {
                    arg0->actor.textId = 0xC55;
                    phi_v0 = 0xC55U;
                    goto block_11;
                }
                arg0->actor.textId = 0xC46;
                temp_v1->textId = 0xC46;
                func_80B40D00(arg1, temp_v0);
            } else {
                phi_v0 = 0xC47U;
                if ((arg0->unk_29C & 0x10) != 0) {
                    arg0->actor.textId = 0xC57;
                    phi_v0 = 0xC57U;
                } else {
                    arg0->actor.textId = 0xC47;
                }
block_11:
                temp_v1->textId = phi_v0;
            }
            arg0->unk_29C |= 8;
        } else if (temp_v0 < 0) {
            if ((arg0->unk_29C & 0x10) != 0) {
                phi_v0_2 = 0xC57U;
            } else {
                phi_v0_2 = 0xC47U;
            }
            arg0->actor.textId = phi_v0_2;
            temp_v1->textId = 0;
            arg1->msgCtx.unk11F10 = 0;
            func_80B41368(arg0, arg1, 4U);
        }
    }
    func_80B40EE8(arg0, arg1);
}

void func_80B41C30(void *arg0, void *arg1) {
    if (arg0 != arg1->unk1CCC->unkA88) {
        arg0->unk304 = func_80B42508;
    }
}

void func_80B41C54(Actor *arg0, GlobalContext *arg1) {
    SkelAnime *temp_a0;

    temp_a0 = arg0 + 0x144;
    arg0 = arg0;
    SkelAnime_FrameUpdateMatrix(temp_a0);
    if (func_800B867C(arg0, arg1) != 0) {
        arg0->unk304 = func_80B41C30;
        arg0->flags &= -0x101;
    }
    func_80B40EE8((EnKgy *) arg0, arg1, arg0);
}

void func_80B41CBC(Actor *arg0, GlobalContext *arg1) {
    SkelAnime_FrameUpdateMatrix(arg0 + 0x144);
    if (func_800B84D0(arg0, arg1) != 0) {
        arg0->flags &= 0xFFFEFFFF;
        func_80B40E18((EnKgy *) arg0, arg0->textId);
        arg0->unk304 = func_80B41E18;
        func_80B411DC((EnKgy *) arg0, arg1, 4U);
        return;
    }
    func_800B8500(arg0, arg1, 1000.0f, 1000.0f, -1);
}

void func_80B41D64(Actor *arg0, GlobalContext *arg1) {
    SkelAnime_FrameUpdateMatrix(arg0 + 0x144);
    if (Actor_HasParent(arg0, arg1) != 0) {
        arg0->unk304 = func_80B41CBC;
        arg0->flags |= 0x10000;
        func_800B8500(arg0, arg1, 1000.0f, 1000.0f, -1);
    } else {
        func_800B8A1C(arg0, arg1, (s32) arg0->unk2EA, 2000.0f, 1000.0f);
    }
    func_80B40EE8((EnKgy *) arg0, arg1);
}

void func_80B41E18(EnKgy *this, GlobalContext *globalCtx) {
    u16 sp46;
    Actor *sp3C;
    void *sp30;
    s32 sp2C;
    u16 temp_a2;
    u16 temp_a2_2;
    u8 temp_v0;
    u8 temp_v0_2;
    u8 temp_v0_3;
    u8 temp_v1;
    u8 phi_v0;

    sp3C = globalCtx->actorCtx.actorList[2].first;
    if ((SkelAnime_FrameUpdateMatrix(&this->skelAnime) != 0) && (this->unk_2D2 == 3)) {
        func_80B40BC0(this, 4);
    }
    if (((s32) this->unk_2E4 <= 0) && ((this->unk_29C & 2) == 0) && (func_80B40E54(this) == 0)) {
        temp_v0 = func_80152498(&globalCtx->msgCtx);
        if (temp_v0 != 4) {
            if (temp_v0 != 5) {

            } else if (func_80147624(globalCtx) != 0) {
                temp_a2 = globalCtx->msgCtx.unk11F04;
                switch (temp_a2) {
                case 3125:
                    globalCtx->msgCtx.unk11F10 = 0;
                    this->actor.textId = temp_a2;
                    this->unk_29C |= 4;
                    this->unk_2E8 = 3;
                    func_80B40E38(this);
                    break;
                case 3126:
                    globalCtx->msgCtx.unk11F10 = 0;
                    func_80B41368(this, globalCtx, 4U);
                    this->actor.textId = func_80B41460();
                    break;
                case 3128:
                case 3129:
                case 3154:
                case 3156:
                    func_801477B4(globalCtx);
                    this->actionFunc = func_80B425A0;
                    func_80B413C8(this);
                    func_80B40E18(this, 5U);
                    func_80B40BC0(this, 4);
                    this->actor.textId = 0xC35;
                    break;
                case 3130:
                    func_80B40E74(this, globalCtx, func_80B41528(globalCtx) & 0xFFFF);
                    func_80B40BC0(this, 4);
                    break;
                case 3132:
                case 3135:
                case 3148:
                    func_80B40EBC((s32) this, globalCtx, temp_a2);
                    break;
                case 3133:
                    func_801477B4(globalCtx);
                    this->actionFunc = (void (*)(EnKgy *, GlobalContext *)) func_80B41C54;
                    this->actor.textId = 0xC3E;
                    func_80B413C8(this);
                    func_80B40E18(this, 2U);
                    break;
                case 3136:
                    globalCtx->msgCtx.unk11F10 = 0;
                    func_80B41368(this, globalCtx, 0U);
                    this->actor.textId = 0xC43;
                    break;
                case 3138:
                    globalCtx->msgCtx.unk11F10 = 0;
                    func_80B41368(this, globalCtx, 0U);
                    this->actor.textId = 0xC43;
                    temp_v1 = gSaveContext.playerForm;
                    if (temp_v1 == 4) {
                        phi_v0 = 0U;
                    } else {
                        phi_v0 = temp_v1;
                    }
                    (&gSaveContext + (phi_v0 * 4))->unk4C = 0xFF;
                    gSaveContext.equips.equipment = (0 << *gEquipShifts) | (gSaveContext.equips.equipment & *gEquipNegMasks);
                    func_80112B40(globalCtx, 0);
                    func_80B40C74(globalCtx);
                    break;
                case 3149:
                case 3160:
                    this->unk_29C |= 0x10;
                    /* fallthrough */
                case 3141:
                    globalCtx->msgCtx.unk11F10 = 0;
                    func_80B41368(this, globalCtx, 3U);
                    this->actor.textId = 0xFF;
                    this->actionFunc = func_80B41ACC;
                    break;
                case 3159:
                    this->unk_29C &= 0xFFF7;
                    func_801477B4(globalCtx);
                    this->actionFunc = (void (*)(EnKgy *, GlobalContext *)) func_80B41C54;
                    this->actor.textId = 0xC58;
                    func_80B413C8(this);
                    func_80B40E18(this, 3U);
                    break;
                case 3142:
                case 3157:
                    sp30 = globalCtx + 0x10000;
                    func_80123D50(globalCtx, (Player *) globalCtx->actorCtx.actorList[2].first, 0x12, 0x15);
                    sp3C->unkA87 = 0;
                    this->unk_29C &= 0xFFF7;
                    globalCtx->msgCtx.unk11F10 = 0;
                    func_80B41368(this, globalCtx, 4U);
                    if ((this->unk_29C & 0x10) != 0) {
                        this->actor.textId = 0xC56;
                        func_801159EC(globalCtx->unk16976);
                    } else {
                        this->actor.textId = 0xC42;
                    }
                    break;
                case 3143:
                    sp46 = temp_a2;
                    func_80B40BC0(this, 1, temp_a2);
                    if ((this->unk_29C & 8) != 0) {
                        sp3C->unkA87 = 0;
                        this->unk_29C &= 0xFFF7;
                    }
                    func_80B40EBC((s32) this, globalCtx, temp_a2);
                    break;
                case 3144:
                    globalCtx->msgCtx.unk11F10 = 0;
                    sp2C = (s32) temp_a2;
                    func_80B41368(this, globalCtx, 0U);
                    this->actor.textId = temp_a2 + 1;
                    break;
                case 3145:
                    globalCtx->msgCtx.unk11F10 = 0;
                    sp2C = (s32) temp_a2;
                    func_80B41368(this, globalCtx, 4U);
                    this->actor.textId = temp_a2 + 1;
                    break;
                case 3146:
                case 3147:
                    func_80B40BC0(this, 4, temp_a2);
                    func_801477B4(globalCtx);
                    this->actionFunc = (void (*)(EnKgy *, GlobalContext *)) func_80B41C54;
                    this->actor.textId = 0xC4B;
                    func_80B413C8(this);
                    func_80B40E18(this, 4U);
                    break;
                case 3152:
                    if (func_80B40D8C(globalCtx) != 0) {
                        this->unk_2EA = 0x39;
                        this->actor.textId = 0xC53;
                    } else {
                        this->unk_2EA = 0x38;
                        this->actor.textId = 0xC51;
                    }
                    func_801477B4(globalCtx);
                    this->actionFunc = (void (*)(EnKgy *, GlobalContext *)) func_80B41D64;
                    func_80B413C8(this);
                    func_800B8A1C((Actor *) this, globalCtx, (s32) this->unk_2EA, 2000.0f, 1000.0f);
                    break;
                case 3153:
                case 3155:
                    globalCtx->msgCtx.unk11F10 = 0;
                    sp2C = (s32) temp_a2;
                    func_80B41368(this, globalCtx, 0U);
                    this->actor.textId = temp_a2 + 1;
                    func_80B40D30(globalCtx);
                    break;
                case 3158:
                    func_801477B4(globalCtx);
                    this->actionFunc = (void (*)(EnKgy *, GlobalContext *)) func_80B41C54;
                    this->actor.textId = 0xC56;
                    func_80B413C8(this);
                    func_80B40E18(this, 8U);
                    break;
                }
            }
        } else if (func_80147624(globalCtx) != 0) {
            temp_a2_2 = globalCtx->msgCtx.unk11F04;
            if (temp_a2_2 != 0xC3B) {
                if (temp_a2_2 != 0xC3E) {

                } else {
                    temp_v0_2 = globalCtx->msgCtx.choiceIndex;
                    if (temp_v0_2 != 0) {
                        if (temp_v0_2 != 1) {

                        } else {
                            func_8019F230();
                            func_80B40E74(this, globalCtx, 0xC3CU);
                        }
                    } else {
                        func_8019F208();
                        func_80B40E74(this, globalCtx, func_80B41460() & 0xFFFF);
                    }
                }
            } else {
                temp_v0_3 = globalCtx->msgCtx.choiceIndex;
                if (temp_v0_3 != 0) {
                    if (temp_v0_3 != 1) {

                    } else {
                        sp46 = temp_a2_2;
                        func_8019F230();
                        func_80B40EBC((s32) this, globalCtx, temp_a2_2);
                    }
                } else if ((s32) gSaveContext.rupees < globalCtx->msgCtx.unk1206C) {
                    play_sound(0x4806U);
                    func_80B40E74(this, globalCtx, 0xC3FU);
                } else {
                    sp30 = globalCtx + 0x10000;
                    func_8019F208();
                    func_80B40E74(this, globalCtx, 0xC42U);
                    func_801159EC((s16) ((s32) globalCtx->msgCtx.unk1206C * -1));
                }
            }
        }
    }
    func_80B40EE8(this, globalCtx);
}

void func_80B42508(EnKgy *this, GlobalContext *globalCtx) {
    Actor *sp20;

    sp20 = globalCtx->actorCtx.actorList[2].first;
    SkelAnime_FrameUpdateMatrix(&this->skelAnime);
    this->actor.focus.pos.x = this->unk_2A8.x;
    this->actor.focus.pos.y = this->unk_2A8.y;
    this->actor.focus.pos.z = this->unk_2A8.z;
    if ((func_800B84D0((Actor *) this, globalCtx) != 0) || (this == sp20->unkA88)) {
        this->actionFunc = func_80B41E18;
        func_80B411DC(this, globalCtx, 4U);
        func_80B40E18(this, this->actor.textId);
    }
}

void func_80B425A0(EnKgy *this, GlobalContext *globalCtx) {
    SkelAnime_FrameUpdateMatrix(&this->skelAnime);
    this->actor.focus.pos.x = this->unk_2A8.x;
    this->actor.focus.pos.y = this->unk_2A8.y;
    this->actor.focus.pos.z = this->unk_2A8.z;
    if (func_800B84D0((Actor *) this, globalCtx) != 0) {
        this->actionFunc = func_80B41E18;
        func_80B40BC0(this, 1);
        func_80B411DC(this, globalCtx, 0U);
        func_80B40E18(this, this->actor.textId);
        return;
    }
    if (this->actor.xzDistToPlayer < 200.0f) {
        func_800B8614((Actor *) this, globalCtx, 210.0f);
    }
}

void func_80B42660(EnKgy *arg0, GlobalContext *arg1) {
    SkelAnime_FrameUpdateMatrix(arg0 + 0x144);
    arg0->actor.focus.pos.x = arg0->unk_2A8.x;
    arg0->actor.focus.pos.y = arg0->unk_2A8.y;
    arg0->actor.focus.pos.z = arg0->unk_2A8.z;
    if ((func_80152498(arg1 + 0x4908) == 5) && (func_80147624(arg1) != 0)) {
        func_801477B4(arg1);
        func_80B413C8(arg0);
        arg0->actor.flags &= -0x101;
        arg0->actionFunc = func_80B42714;
        func_80B40E18(arg0, 7U);
    }
    func_80B40EE8(arg0, arg1);
}

void func_80B42714(EnKgy *this, GlobalContext *globalCtx) {
    Actor *sp20;

    sp20 = globalCtx->actorCtx.actorList[2].first;
    SkelAnime_FrameUpdateMatrix(&this->skelAnime);
    this->actor.focus.pos.x = this->unk_2A8.x;
    this->actor.focus.pos.y = this->unk_2A8.y;
    this->actor.focus.pos.z = this->unk_2A8.z;
    if ((func_800B84D0((Actor *) this, globalCtx) != 0) || (this == sp20->unkA88)) {
        func_80B411DC(this, globalCtx, 4U);
        func_80B40E18(this, this->actor.textId);
        if (this->actor.textId == 0xC37) {
            this->actionFunc = func_80B42660;
            return;
        }
        this->actionFunc = func_80B41E18;
        /* Duplicate return node #5. Try simplifying control flow for better match */
    }
}

void func_80B427C8(EnKgy *arg0, GlobalContext *arg1) {
    s32 sp24;
    u16 temp_a2;

    if (SkelAnime_FrameUpdateMatrix(arg0 + 0x144) != 0) {
        if (arg0->unk_2D2 == 5) {
            func_80B40BC0(arg0, 7);
        }
        if (arg0->unk_2D2 == 3) {
            func_80B40BC0(arg0, 4);
        }
    }
    if (((s32) arg0->unk_2E4 <= 0) && ((arg0->unk_29C & 2) == 0) && (func_80B40E54(arg0) == 0) && (func_80152498(arg1 + 0x4908) == 5) && (func_80147624(arg1) != 0)) {
        temp_a2 = arg1->msgCtx.unk11F04;
        switch (temp_a2) {
        case 3120:
            arg1->msgCtx.unk11F10 = 0;
            arg0->actor.textId = temp_a2;
            arg0->unk_29C |= 4;
            arg0->unk_2E8 = 3;
            break;
        case 3121:
            arg1->msgCtx.unk11F10 = 0;
            sp24 = (s32) temp_a2;
            func_80B41368(arg0, arg1, 4U);
            arg0->actor.textId = temp_a2 + 1;
            break;
        case 3122:
        case 3123:
            func_80B40EBC((s32) arg0, arg1, temp_a2);
            break;
        case 3124:
            func_801477B4(arg1);
            arg0->actionFunc = (void (*)(EnKgy *, GlobalContext *)) func_80B41C54;
            func_80B413C8(arg0);
            func_80B40E18(arg0, 6U);
            func_80B40BC0(arg0, 4);
            arg0->actor.textId = 0xC3A;
            break;
        }
    }
    func_80B40EE8(arg0, arg1);
}

void func_80B4296C(EnKgy *arg0, GlobalContext *arg1) {
    if ((SkelAnime_FrameUpdateMatrix(arg0 + 0x144) != 0) && (arg0->unk_2D2 == 8)) {
        func_80B40BC0(arg0, 2);
    }
    arg0->actor.focus.pos.x = arg0->unk_2A8.x;
    arg0->actor.focus.pos.y = arg0->unk_2A8.y;
    arg0->actor.focus.pos.z = arg0->unk_2A8.z;
    if (func_800B84D0((Actor *) arg0, arg1) != 0) {
        arg0->actionFunc = func_80B427C8;
        if (arg0->unk_2D2 == 4) {
            func_80B40BC0(arg0, 7);
        } else {
            func_80B40B38(arg0, 5, 2U, -5.0f);
        }
        func_80B411DC(arg0, arg1, 0U);
        func_80B40E18(arg0, arg0->actor.textId);
        arg0->actor.flags &= 0xFFFEFFFF;
        return;
    }
    arg0->actor.flags |= 0x10000;
    func_800B8500((Actor *) arg0, arg1, 1000.0f, 1000.0f, 0);
}

void func_80B42A8C(EnKgy *arg0, GlobalContext *arg1) {
    u16 sp2E;
    s32 sp24;
    u16 temp_a2;

    if (SkelAnime_FrameUpdateMatrix(arg0 + 0x144) != 0) {
        if (arg0->unk_2D2 == 5) {
            func_80B40BC0(arg0, 1);
        }
        if (arg0->unk_2D2 == 3) {
            func_80B40BC0(arg0, 4);
        }
    }
    if (((s32) arg0->unk_2E4 <= 0) && ((arg0->unk_29C & 2) == 0) && (func_80B40E54(arg0) == 0) && (func_80152498(arg1 + 0x4908) == 5) && (func_80147624(arg1) != 0)) {
        temp_a2 = arg1->msgCtx.unk11F04;
        switch (temp_a2) {
        case 3101:
        case 3117:
            arg1->msgCtx.unk11F10 = 0;
            arg0->actor.textId = temp_a2;
            arg0->unk_29C |= 4;
            arg0->unk_2E8 = 3;
            break;
        case 3102:
            arg1->msgCtx.unk11F10 = 0;
            sp24 = (s32) temp_a2;
            func_80B41368(arg0, arg1, 1U);
            arg0->actor.textId = temp_a2 + 1;
            func_80B40E38(arg0);
            break;
        case 3103:
        case 3107:
        case 3108:
        case 3111:
            func_80B40EBC((s32) arg0, arg1, temp_a2);
            break;
        case 3104:
        case 3112:
            sp2E = temp_a2;
            func_80B40BC0(arg0, 1, temp_a2);
            arg1->msgCtx.unk11F10 = 0;
            arg0->unk_2E8 = 3;
            arg0->unk_29C |= 4;
            arg0->actor.textId = temp_a2;
            func_80B40E38(arg0);
            break;
        case 3105:
        case 3113:
            arg1->msgCtx.unk11F10 = 0;
            sp24 = (s32) temp_a2;
            func_80B41368(arg0, arg1, 0U);
            arg0->actor.textId = temp_a2 + 1;
            break;
        case 3106:
        case 3110:
        case 3115:
        case 3118:
            arg1->msgCtx.unk11F10 = 0;
            sp24 = (s32) temp_a2;
            func_80B41368(arg0, arg1, 1U);
            arg0->actor.textId = temp_a2 + 1;
            break;
        case 3109:
            arg1->msgCtx.unk11F10 = 0;
            sp24 = (s32) temp_a2;
            func_80B41368(arg0, arg1, 2U);
            arg0->actor.textId = temp_a2 + 1;
            break;
        case 3114:
            arg0->unk_2E4 = 0x14;
            arg0->unk_2E2 = 3;
            func_80B40EBC((s32) arg0, arg1, arg0->actor.textId);
            break;
        case 3116:
        case 3119:
            func_801477B4(arg1);
            arg0->actionFunc = func_80B42D28;
            func_80B413C8(arg0);
            func_80B40E18(arg0, 1U);
            break;
        }
    }
    func_80B40EE8(arg0, arg1);
}

void func_80B42D28(EnKgy *arg0, GlobalContext *arg1) {
    if ((SkelAnime_FrameUpdateMatrix(&arg0->skelAnime) != 0) && (arg0->unk_2D2 == 8)) {
        func_80B40BC0(arg0, 2);
    }
    arg0->actor.focus.pos.x = arg0->unk_2A8.x;
    arg0->actor.focus.pos.y = arg0->unk_2A8.y;
    arg0->actor.focus.pos.z = arg0->unk_2A8.z;
    if (func_800B84D0((Actor *) arg0, arg1) != 0) {
        arg0->actionFunc = func_80B42A8C;
        if (arg0->actor.textId == 0xC2D) {
            func_80B40BC0(arg0, 1);
        } else {
            func_80B40B38(arg0, 5, 2U, -5.0f);
            gSaveContext.weekEventReg[20] |= 0x80;
        }
        func_80B411DC(arg0, arg1, 0U);
        func_80B40E18(arg0, arg0->actor.textId);
        return;
    }
    if (Flags_GetSwitch(arg1, (s32) (arg0->actor.params & 0xFE00) >> 9) != 0) {
        arg0->actor.textId = 0xC30;
        arg0->actionFunc = func_80B4296C;
        gSaveContext.weekEventReg[21] |= 1;
    } else if (arg0->actor.xzDistToPlayer < 200.0f) {
        if (arg0->unk_2D2 == 4) {
            arg0->actor.textId = 0xC2D;
        } else {
            arg0->actor.textId = 0xC1D;
        }
        func_800B8614((Actor *) arg0, arg1, 210.0f);
    }
    if ((arg0->unk_2D2 == 0) && (arg0->actor.xzDistToPlayer < 200.0f)) {
        func_80B40B38(arg0, 8, 2U, 5.0f);
    }
}

void EnKgy_Update(EnKgy *this, GlobalContext *globalCtx) {
    s16 sp34;
    s16 sp32;
    s16 sp30;
    EnKgy *this = (EnKgy *) thisx;

    this->actionFunc(this, globalCtx);
    if (this->unk_2D2 == 2) {
        sp34 = 0;
        sp32 = 0;
        sp30 = 0;
        func_800E9250(globalCtx, (Actor *) this, &this->unk_2CC, (Vec3s *) &sp30, (bitwise Vec3f) this->actor.focus.pos.x, this->actor.focus.pos.y, this->actor.focus.pos.z);
        return;
    }
    Math_SmoothStepToS((s16 *) &this->unk_2CC, 0, 6, 0x1838, (s16) 0x64);
    Math_SmoothStepToS(&this->unk_2CC.y, 0, 6, 0x1838, (s16) 0x64);
}

s32 func_80B42FA0(GlobalContext *arg0, s32 arg1, Gfx **arg2, Vec3f *arg3, s16 *arg4, Actor *arg5) {
    if ((arg5->unk29C & 1) == 0) {
        if (arg1 == 0x11) {
            goto block_4;
        }
    } else if (arg1 == 0x10) {
block_4:
        *arg2 = NULL;
    }
    if (arg1 == 0xB) {
        *arg4 += arg5->unk2CE;
    }
    return 0;
}

void func_80B43008(GlobalContext *arg0, s32 arg1, Gfx **arg2, Vec3s *arg3, Actor *arg4) {
    if (arg1 == 0xB) {
        arg1 = arg1;
        SysMatrix_MultiplyVector3fByState(&D_80B432D8, arg4 + 0x2A8);
    }
    if (arg1 == 0x10) {
        SysMatrix_MultiplyVector3fByState(&D_80B432E4, arg4 + 0x2C0);
    }
}

void func_80B43074(Actor *arg0, GlobalContext *arg1) {
    Gfx *sp20;
    GraphicsContext *sp1C;
    Gfx *temp_v1;
    GraphicsContext *temp_a0;

    temp_a0 = arg1->state.gfxCtx;
    sp1C = temp_a0;
    func_8012C28C(temp_a0);
    func_800B8050(arg0, arg1, 0);
    SysMatrix_StatePush();
    SysMatrix_InsertTranslation(-800.0f, 3100.0f, 8400.0f, 1);
    SysMatrix_InsertXRotation_s(0x4000, 1);
    if (func_80B40D8C(arg1) != 0) {
        AnimatedMat_Draw(arg1, Lib_SegmentedToVirtual(&D_0600F6A0));
    } else {
        AnimatedMat_Draw(arg1, Lib_SegmentedToVirtual(&D_0600EE58));
    }
    temp_v1 = sp1C->polyOpa.p;
    temp_v1->words.w0 = 0xDA380003;
    sp20 = temp_v1;
    temp_v1->words.w1 = Matrix_NewMtx(arg1->state.gfxCtx);
    sp20 = temp_v1;
    if (func_80B40D8C(arg1) != 0) {
        temp_v1->unkC = &D_04001D00;
        temp_v1->unk8 = 0xDE000000;
        temp_v1->unk14 = &D_0600F180;
        temp_v1->unk10 = 0xDE000000;
    } else {
        temp_v1->unkC = &D_040021A8;
        temp_v1->unk8 = 0xDE000000;
        temp_v1->unk14 = &D_0600E8F0;
        temp_v1->unk10 = 0xDE000000;
    }
    sp1C->polyOpa.p = temp_v1 + 0x18;
    SysMatrix_StatePop();
}

void EnKgy_Draw(EnKgy *this, GlobalContext *globalCtx) {
    EnKgy *this = (EnKgy *) thisx;
    func_8012C28C(globalCtx->state.gfxCtx);
    if ((this->unk_29C & 1) != 0) {
        func_80B43074((Actor *) this, globalCtx);
    }
    SkelAnime_DrawSV(globalCtx, this->skelAnime.skeleton, this->skelAnime.limbDrawTbl, (s32) this->skelAnime.dListCount, (s32 (*)(GlobalContext *, s32, Gfx **, Vec3f *, Vec3s *, Actor *)) func_80B42FA0, func_80B43008, (Actor *) this);
}
